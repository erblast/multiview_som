"0","# categoricals--------------------------------------------------------"
"0","d_plot = data_pred %>%"
"0","  as_tibble() %>%"
"0","  select( one_of(factors), cluster ) %>%"
"0","  gather(key = 'key', value = 'value', one_of(factors) )"
"0","# to preserve factor order we have to add a sorting column"
"0","d_order = data_pred %>%"
"0","  as_tibble() %>%"
"0","  select( one_of(factors), cluster ) %>%"
"0","  mutate_all( as.integer ) %>%"
"0","  gather(key = 'key', value = 'order', one_of(factors) ) %>%"
"0","  mutate( order = stringr::str_c(key, order))"
"0","d_plot = d_plot %>%"
"0","  bind_cols( select(d_order, order) )%>%"
"0","  arrange( order ) %>%"
"0","  # we have to convert value to factor here"
"0","  # ggplot will mess up the order if some "
"0","  # facet groups dont have all levels()"
"0","  mutate( value = forcats::as_factor(value))"
"0","ggplot(d_plot ) +"
"0","  geom_bar( aes( x = forcats::as_factor(value)"
"0","                , y = ..prop.."
"0","                , fill = key"
"0","                , group = key)"
"0","            )+"
"0","  facet_wrap(~ cluster"
"0","             ,ncol = 1)+"
"0","  labs(title = 'Percentages for each level of each factor level\n of each cluster',"
"0","       fill = 'factors')+"
"0","  theme(axis.text.x = element_text(angle = 90))"
